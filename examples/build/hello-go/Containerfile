FROM docker.io/library/golang:1.22-alpine AS build
WORKDIR /src
COPY main.go ./
RUN CGO_ENABLED=0 GOOS=linux go build -trimpath -ldflags='-s -w' -o /out/server main.go

FROM docker.io/library/alpine:latest
RUN adduser -D -u 10001 app
USER 10001
EXPOSE 8080
COPY --from=build /out/server /server
CMD ["/server"]
